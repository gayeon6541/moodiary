<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ê½ƒ ì¹´ë“œ ê°¤ëŸ¬ë¦¬</title>

    <!-- Fonts -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pretendard@1.3.9/dist/web/static/pretendard.css"
        crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500&display=swap" rel="stylesheet">

    <style>
        :root {
            --ink: #111;
            --muted: #666;
            --bg: #fff;
            --header-h: 72px;
            /* indexì™€ ë™ì¼ */
            --gap: 16px;
            --side: clamp(18px, 3.8vw, 48px);
            --card-b: #111;
            --surface: #fff;
            --gray: #f2f2f2;
            --pill: #111;
            --pill-bg: #fff7d6;
        }

        * {
            box-sizing: border-box;
        }

        html,
        body {
            height: 100%;
            cursor: none;

        }

        body {
            margin: 0;
            background: var(--bg);
            color: var(--ink);
            font-family: Pretendard, system-ui, -apple-system, BlinkMacSystemFont, Inter, sans-serif;
            line-height: 1.55;
            /* flower í˜ì´ì§€ì—ì„œëŠ” ì»¤ìŠ¤í…€ ì»¤ì„œê°€ ì—†ìœ¼ë¯€ë¡œ cursor: none ì€ ì ìš©í•˜ì§€ ì•ŠìŒ */
            /* ê³ ì • í—¤ë” ë†’ì´ë§Œí¼ íŒ¨ë”© */
        }

        /* ===== Header (indexì™€ ë™ì¼ ìŠ¤íƒ€ì¼) ===== */
        header.site {
            position: sticky;
            top: 0;
            z-index: 50;
            height: var(--header-h);
            background: rgba(255, 255, 255, .9);
            backdrop-filter: blur(6px);
            border-bottom: 1px solid #eaeaea;
        }

        .wrap {
            max-width: 100%;
            margin: 0 auto;
            padding: 0 var(--side);
        }

        .bar {
            height: var(--header-h);
            display: grid;
            gap: 10px;
            grid-template-columns: 140px 1fr auto auto;
            align-items: center;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            color: inherit;
        }

        .brand img {
            width: 40px;
            height: 40px;
            display: block;
            animation: float 2.4s ease-in-out infinite;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-5px);
            }
        }

        nav.main {
            display: flex;
            justify-content: flex-end;
            gap: 22px;
        }

        nav.main a {
            position: relative;
            text-decoration: none;
            color: var(--ink);
            padding: 4px 2px;
            font-weight: 500;
        }

        nav.main a::after {
            content: "";
            position: absolute;
            left: 0;
            right: 0;
            bottom: -6px;
            height: 2px;
            background: currentColor;
            transform: scaleX(0);
            transform-origin: 0 50%;
            transition: transform .25s;
        }

        nav.main a:hover::after {
            transform: scaleX(1);
        }

        .sound {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: var(--muted);
            margin-left: clamp(10px, 1.2vw, 18px);
        }

        .sound button {
            border: 1.25px solid #000;
            border-radius: 0;
            background: #fff;
            padding: 8px 12px;
            cursor: pointer;
            transition: background .25s ease, color .25s ease;
        }

        .sound button:hover {
            background: #000;
            color: #fff;
        }

        /* ===== Page wrapper ===== */
        .page {
            width: 100%;
            max-width: 1800px;
            margin: 0 auto;
            padding: 24px var(--side) 48px;
            display: flex;
            flex-direction: column;
            gap: 18px;
        }

        .title {
            font-size: 30px;
            letter-spacing: .5px;
            text-align: center;
            margin: 10px 0 0;
            color: #222;
        }

        .sub {
            font-size: 14px;
            color: #666;
            text-align: center;
            margin: 0 0 6px;
        }

        /* ===== CircularGallery (flower ê¸°ì¡´ ìœ ì§€) ===== */
        .circular-wrap {
            background: #fff;
            border-radius: 8px;
            overflow: hidden;
            height: 640px;
            position: relative;
        }

        .circular-gallery {
            width: 100%;
            height: 100%;
            position: relative;
            cursor: grab;
            user-select: none;
            will-change: transform;
        }

        .circular-gallery:active {
            cursor: grabbing;
        }

        .cg-item {
            position: absolute;
            left: 25%;
            transform: translate(-50%, -50%);
            width: clamp(200px, 17vw, 260px);
            display: flex;
            flex-direction: column;
            background: #fff;
            overflow: hidden;
            box-shadow: 0 12px 36px rgba(0, 0, 0, .10);
            transition: box-shadow .25s ease;
        }


        .cg-item .img {
            display: grid;
            place-items: center;
            background: #fff;
            aspect-ratio: 4/3;
        }

        .cg-item .img img {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            display: block;
            object-fit: contain;
            /* ì•ˆì „í•˜ê²Œ ë¹„ìœ¨ ìœ ì§€ */
        }


        .cg-item .caption {
            font-family: ui-serif, "Times New Roman", Georgia, serif !important;
            font-weight: 800 !important;
            letter-spacing: .8px !important;
            text-transform: uppercase;
            font-size: clamp(16px, 3.6vw, 22px) !important;
            color: #111 !important;
            padding: 6px 8px !important;
            /* ìˆ˜ì •: ì—¬ë°± ì¤„ì„ */
            text-align: center;
        }


        .hint {
            position: absolute;
            left: 50%;
            bottom: 12px;
            transform: translateX(-50%);
            font-size: 12px;
            color: #888;
            background: #fff;
            padding: 6px 10px;
            border: 1px solid #e1e1e1;
        }

        /* (ì„ íƒ) í•˜ë‹¨ ìŠ¤í¬ë¡¤ë°” */
        .bottom-scroll {
            width: min(21000px, 100%);
            margin: 10px auto 0;
            height: 4px;
            border-radius: 999px;
            background: rgba(0, 0, 0, .08);
            -webkit-appearance: none;
            appearance: none;
        }

        .bottom-scroll::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 40px;
            height: 12px;
            border-radius: 999px;
            border: 0;
            background: linear-gradient(45deg, #b7b7b7, #c8c8c8);
            cursor: pointer;
        }

        .bottom-scroll::-moz-range-thumb {
            width: 40px;
            height: 12px;
            border-radius: 999px;
            border: 0;
            background: linear-gradient(45deg, #a9a9a9, #d1d1d1);
            cursor: pointer;
        }

        /* Responsive: index í—¤ë” ê·¸ë¦¬ë“œì™€ ì¡°í™” */
        @media(max-width:640px) {
            .bar {
                grid-template-columns: 110px 1fr auto auto;
            }
        }

        .flower-cursor {
            position: fixed;
            left: 0;
            top: 0;
            z-index: 9999;
            pointer-events: none;
            user-select: none;
            width: 40px;
            height: 40px;
            display: grid;
            place-items: center;
            font-size: 24px;
            line-height: 1;
            transform: translate(-50%, -50%);
            filter: drop-shadow(0 2px 2px rgba(0, 0, 0, .12));
        }

        .flower-cursor::before {
            content: "";
            position: absolute;
            inset: 0;
            border: 2px solid #111;
            border-radius: 999px;
            box-sizing: border-box;
        }

        .flower-cursor.active {
            font-size: 26px;
        }

        .cg-item .caption {
            display: none !important;
        }
    </style>
</head>

<body>
    <!-- Header (indexì™€ ë™ì¼ êµ¬ì¡°) -->
    <header class="site">
        <div class="wrap">
            <div class="bar">
                <a class="brand" href="index.html" aria-label="MOODIARY Home">
                    <img src="img/sub-flower.svg" alt="MOODIARY ë¡œê³ "><span>MOODIARY</span>
                </a>
                <div></div>
                <nav class="main" aria-label="Main">
                    <a href="today-loding.html">Today</a>
                    <a href="diary-loding.html">Diary</a>
                    <a href="flower-loding.html" class="active">Flower</a>
                </nav>
                <div class="sound">
                    <button id="soundToggle" aria-pressed="false">ğŸ”Š Sound (On)</button>
                    <audio id="bgm" preload="auto" autoplay loop playsinline src="audio/temp.mp3"></audio>
                </div>
            </div>
        </div>
    </header>


    <main class="page" aria-label="Flower Cards">

        <!-- Circular gallery -->
        <div class="circular-wrap">
            <div id="circularGallery" class="circular-gallery" aria-label="Flower circular gallery"></div>
        </div>

        <!-- (ì„ íƒ) í•˜ë‹¨ ì»¤ìŠ¤í…€ ìŠ¤í¬ë¡¤ë°”: ê°¤ëŸ¬ë¦¬ ìŠ¤í¬ë¡¤ ì—°ë™ -->
        <input type="range" id="scrollbar" class="bottom-scroll" min="0" value="0" />

        <p class="sub">ë“œë˜ê·¸ ë˜ëŠ” ìŠ¤í¬ë¡¤ë¡œ ì¹´ë“œë¥¼ ë„˜ê²¨ë³´ì„¸ìš”.</p>
    </main>

    <script>
        /* ===== BGM (index.htmlê³¼ ë™ì¼ ë¡œì§) ===== */
        (function BGM() {
            const audio = document.getElementById('bgm');
            const btn = document.getElementById('soundToggle');
            const STATE_KEY = 'moodiary_bgm_state', POS_KEY = 'moodiary_bgm_pos', VOL_KEY = 'moodiary_bgm_vol';

            function setBtn(on) {
                btn.textContent = on ? 'ğŸ”Š Sound (On)' : 'ğŸ”ˆ Sound (Off)';
                btn.setAttribute('aria-pressed', on);
            }

            const fps = 60;
            function fadeTo(target = 0.35, ms = 800) {
                target = Math.max(0, Math.min(1, target));
                const step = (target - audio.volume) / (ms / (1000 / fps));
                const t = setInterval(() => {
                    audio.volume = Math.max(0, Math.min(1, audio.volume + step));
                    if ((step > 0 && audio.volume >= target) || (step < 0 && audio.volume <= target)) {
                        clearInterval(t);
                        localStorage.setItem(VOL_KEY, String(audio.volume));
                    }
                }, 1000 / fps);
            }

            async function tryPlay() {
                try {
                    audio.muted = false;
                    audio.volume = parseFloat(localStorage.getItem(VOL_KEY) || '0.30');
                    await audio.play();
                    setBtn(true);
                    fadeTo(parseFloat(localStorage.getItem(VOL_KEY) || '0.35'), 700);
                } catch (e) {
                    setBtn(false);
                    const unlock = async () => {
                        try {
                            await audio.play();
                            setBtn(true);
                            fadeTo(parseFloat(localStorage.getItem(VOL_KEY) || '0.35'), 700);
                        } catch { }
                        finally {
                            window.removeEventListener('pointerdown', unlock, { once: true });
                        }
                    };
                    window.addEventListener('pointerdown', unlock, { once: true });
                }
            }

            audio.addEventListener('loadedmetadata', () => {
                const pos = parseFloat(localStorage.getItem(POS_KEY) || '0');
                if (isFinite(pos) && pos > 0 && (!isFinite(audio.duration) || pos < audio.duration - 0.4)) {
                    audio.currentTime = pos;
                }
            });

            const savePos = () => {
                if (isFinite(audio.currentTime)) localStorage.setItem(POS_KEY, String(audio.currentTime));
            };
            const timer = setInterval(savePos, 1000);
            window.addEventListener('pagehide', savePos);

            btn.addEventListener('click', async () => {
                if (audio.paused) {
                    localStorage.setItem(STATE_KEY, 'on');
                    await tryPlay();
                } else {
                    audio.pause();
                    setBtn(false);
                    localStorage.setItem(STATE_KEY, 'off');
                }
            });

            if ((localStorage.getItem(STATE_KEY) ?? 'on') === 'on') {
                tryPlay();
            } else {
                setBtn(false);
            }
            document.addEventListener('visibilitychange', () => {
                if (!document.hidden && localStorage.getItem(STATE_KEY) === 'on' && audio.paused) {
                    tryPlay();
                }
            });
        })();
    </script>

    <script>
        /* ===== CircularGallery (flower ê¸°ì¡´ ì¸í„°ë™ì…˜) ===== */
        (function () {
            const root = document.getElementById('circularGallery');
            if (!root) return;

            const OPTIONS = {
                bend: 0.0,          // 0=ì§ì„ 
                borderRadius: 0.20,
                scrollEase: 0.035,
                scrollSpeed: 1.6
            };


            // 12 ê½ƒ - ë„¤ê°€ ë§Œë“  flowers2 SVGë§Œ ì‚¬ìš© (íŒŒì¼ëª…ì€ í•„ìš”ì— ë”°ë¼ ìˆ˜ì •)
            const items = [
                'babybreath2',
                'lavender2',
                'freesia2',
                'daisy2',
                'white-lily2',
                'lilac2',
                'white-tulip2',
                'sunflower2',
                'peony2',
                'forgetmenot2',
                'lotus2',
                'hydrangea2'
            ].map(name => ({
                image: `img/flowers2/${name}.svg`,
                text: '' // ìº¡ì…˜ ê°ì¶¤: ìœ„ CSSë¡œ display:none ì²˜ë¦¬
            }));

            const cards = [];
            items.forEach(it => {
                const card = document.createElement('div');
                card.className = 'cg-item';
                card.style.setProperty('--br', OPTIONS.borderRadius);

                const imgBox = document.createElement('div');
                imgBox.className = 'img';
                const img = document.createElement('img');
                img.src = it.image; img.alt = it.text;
                imgBox.appendChild(img);

                card.appendChild(imgBox);
                card.tabIndex = 0;
                card.setAttribute('role', 'button');
                card.setAttribute('aria-label', `${it.text} ìƒì„¸ ë³´ê¸°`);

                // í´ë¦­/Enter â†’ ìƒì„¸ ì´ë™
                const slug = it.image
                    .split('/').pop().replace(/\.svg$/i, '')
                    .replace(/2$/, '');
                card.addEventListener('click', () => {
                    location.href = `flower-detail.html?flower=${encodeURIComponent(slug)}`;
                });
                card.addEventListener('keydown', e => {
                    if (e.key === 'Enter') card.click();
                });

                root.appendChild(card);
                cards.push(card);
            });

            const state = {
                viewportW: 0,
                itemW: 0, itemH: 0,
                padding: 24,
                total: cards.length,
                baseX: [],
                stride: 0, widthTotal: 0,
                scroll: { current: 0, target: 0, last: 0 },
                isDown: false, startX: 0, startScroll: 0
            };

            function measure() {
                state.viewportW = root.clientWidth;

                // ì¹´ë“œ í­ ì¸¡ì •(ì •í™•ê°’)
                const temp = cards[0].cloneNode(true);
                temp.style.visibility = 'hidden';
                temp.style.transform = 'translate(-50%,-50%)';
                root.appendChild(temp);
                const r = temp.getBoundingClientRect();
                state.itemW = r.width; state.itemH = r.height;
                temp.remove();

                state.stride = state.itemW + state.padding;
                state.widthTotal = state.stride * state.total;

                state.baseX = Array.from({ length: state.total }, (_, i) => i * state.stride);
            }

            function arcY(x, H, bend) {
                if (bend === 0) return 0;
                const B = Math.abs(bend);
                const R = (H * H + B * B) / (2 * B);
                const ex = Math.min(Math.abs(x), H);
                const arc = R - Math.sqrt(Math.max(R * R - ex * ex, 0));
                return (bend > 0) ? -arc : arc;
            }

            function place() {
                const H = state.viewportW / 2;
                const bend = OPTIONS.bend;
                const centerX = state.scroll.current % state.widthTotal;

                for (let i = 0; i < state.total; i++) {
                    let x = state.baseX[i] - centerX;
                    if (x < -state.widthTotal / 2) x += state.widthTotal;
                    if (x > state.widthTotal / 2) x -= state.widthTotal;

                    const px = x;
                    const py = arcY(px, H, bend) * 0.9;

                    // íšŒì „(ì•„ì¹˜ ì ‘ì„ )
                    const rot = (bend === 0) ? 0 :
                        (Math.asin(Math.min(Math.max(px / ((H * H + Math.abs(bend) * Math.abs(bend)) / (2 * Math.abs(bend))), -1), 1)) * (bend > 0 ? -1 : 1));

                    const el = cards[i];
                    let t = `translate(calc(50% + ${px}px), calc(50% + ${py}px)) rotate(${rot}rad)`;

                    // ê¹Šì´ê°(ì¤‘ì•™â†‘)
                    const far = Math.min(Math.abs(px) / H, 1);
                    const scale = 1 - far * 0.15;
                    t += ` scale(${scale})`;
                    el.style.transform = t;

                    // ë’¤ìª½ì€ íˆ¬ëª…/í´ë¦­ ê¸ˆì§€
                    if (Math.abs(px) > H * 0.9) {
                        el.style.opacity = 0;
                        el.style.pointerEvents = 'none';
                    } else {
                        el.style.opacity = 1;
                        el.style.pointerEvents = 'auto';
                    }
                    el.style.zIndex = String(1000 - Math.floor(far * 1000));
                }
            }

            function tick() {
                state.scroll.current += (state.scroll.target - state.scroll.current) * OPTIONS.scrollEase;
                place();
                state.scroll.last = state.scroll.current;
                requestAnimationFrame(tick);
            }

            // ì…ë ¥
            function onWheel(e) {
                const dy = e.deltaY || e.wheelDelta || e.detail || 0;
                state.scroll.target += (dy > 0 ? OPTIONS.scrollSpeed : -OPTIONS.scrollSpeed) * state.stride * 0.2;
                syncRange();
            }
            function onDown(e) {
                state.isDown = true;
                state.startX = (e.touches ? e.touches[0].clientX : e.clientX);
                state.startScroll = state.scroll.target;
            }
            function onMove(e) {
                if (!state.isDown) return;
                const x = (e.touches ? e.touches[0].clientX : e.clientX);
                const dist = (state.startX - x) * OPTIONS.scrollSpeed * 0.6;
                state.scroll.target = state.startScroll + dist;
                syncRange();
            }
            function onUp() { state.isDown = false; }

            // í•˜ë‹¨ rangeì™€ ì—°ë™(ì˜µì…˜)
            const range = document.getElementById('scrollbar');
            function syncRangeMax() { if (range) range.max = String(state.widthTotal); }
            function syncRange() { if (range) range.value = String((state.scroll.target % state.widthTotal + state.widthTotal) % state.widthTotal); }
            if (range) {
                range.addEventListener('input', (e) => {
                    const v = Number(e.target.value) || 0;
                    state.scroll.target = v;
                });
            }

            measure(); place(); tick(); syncRangeMax(); syncRange();

            window.addEventListener('resize', () => { measure(); place(); syncRangeMax(); syncRange(); });
            root.addEventListener('wheel', onWheel, { passive: true });
            root.addEventListener('mousedown', onDown);
            window.addEventListener('mousemove', onMove);
            window.addEventListener('mouseup', onUp);
            root.addEventListener('touchstart', onDown, { passive: true });
            window.addEventListener('touchmove', onMove, { passive: true });
            window.addEventListener('touchend', onUp);
        })();
    </script>

    <script>
        // âœ¿ Custom Flower Cursor (same as index.html)
        (function () {
            const c = document.createElement('div');
            c.className = 'flower-cursor';
            c.textContent = 'âœ¿';
            document.body.appendChild(c);

            let x = 0, y = 0, tx = 0, ty = 0;
            document.addEventListener('mousemove', e => { x = e.clientX; y = e.clientY; });

            // ë§í¬/ë²„íŠ¼ ìœ„ì— ì˜¬ë¦¬ë©´ ì‚´ì§ ì»¤ì§€ëŠ” íš¨ê³¼
            document.addEventListener('mouseover', e => {
                if (e.target.closest('a,button')) c.classList.add('active');
                else c.classList.remove('active');
            });

            // ë¶€ë“œëŸ¬ìš´ ì¶”ì 
            (function loop() {
                tx += (x - tx) * 0.25;
                ty += (y - ty) * 0.25;
                c.style.transform = `translate(${tx}px, ${ty}px) translate(-50%,-50%)`;
                requestAnimationFrame(loop);
            })();
        })();
    </script>

</body>

</html>
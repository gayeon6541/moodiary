<!doctype html>
<html lang="ko">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>MOODIARY â€“ Today</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pretendard@1.3.9/dist/web/static/pretendard.css"
        crossorigin>
    <style>
        @font-face {
            font-family: 'HsBombaram30';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_20-10@1.1/HSBombaram3_Thin.woff') format('woff');
            font-weight: 100;
            font-display: swap
        }

        @font-face {
            font-family: 'HsBombaram30';
            src: url('https://gcore.jsdelivr.net/gh/projectnoonnu/noonfonts_20-10@1.1/HSBombaram3_Regular.woff') format('woff');
            font-weight: 400;
            font-display: swap
        }

        @import url('https://fonts.googleapis.com/css2?family=IM+Fell+Double+Pica+SC&display=swap');

        :root {
            --ink: #111;
            --muted: #666;
            --bg: #fff;
            --header-h: 72px;
            --gap: 14px;
            --side: clamp(16px, 4vw, 60px);
            --content-max: 1440px;
            --border-w: .5px;
            --line: #111;
            --radius: 0;
        }

        * {
            box-sizing: border-box
        }

        html,
        body {
            height: 100%;
            margin: 0;
            overflow: hidden;
        }

        /* ì „ì²´ í•œ í™”ë©´, ìŠ¤í¬ë¡¤ ì œê±° */

        body {
            background: var(--bg);
            color: var(--ink);
            font-family: Pretendard, system-ui, -apple-system, BlinkMacSystemFont, Inter, sans-serif;
            line-height: 1.55;
            cursor: none;
        }

        header.site {
            position: sticky;
            top: 0;
            z-index: 50;
            height: var(--header-h);
            background: rgba(255, 255, 255, .9);
            backdrop-filter: blur(6px);
            border-bottom: 1px solid #eaeaea
        }

        .wrap {
            max-width: 100%;
            margin: 0 auto;
            padding: 0 var(--side)
        }

        .bar {
            height: var(--header-h);
            display: grid;
            gap: 10px;
            grid-template-columns: 140px 1fr auto auto;
            align-items: center
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            color: inherit
        }

        .brand img {
            width: 40px;
            height: 40px;
            display: block;
            animation: float 2.4s ease-in-out infinite
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0)
            }

            50% {
                transform: translateY(-5px)
            }
        }

        nav.main {
            display: flex;
            justify-content: flex-end;
            gap: 22px
        }

        nav.main a {
            position: relative;
            text-decoration: none;
            color: var(--ink);
            padding: 4px 2px;
            font-weight: 500
        }

        nav.main a::after {
            content: "";
            position: absolute;
            left: 0;
            right: 0;
            bottom: -6px;
            height: 2px;
            background: currentColor;
            transform: scaleX(0);
            transform-origin: 0 50%;
            transition: transform .25s
        }

        nav.main a:hover::after {
            transform: scaleX(1)
        }

        .sound {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: var(--muted);
            margin-left: clamp(10px, 1.2vw, 18px)
        }

        .sound button {
            border: 1.25px solid #000;
            border-radius: 0;
            background: #fff;
            padding: 8px 12px;
            cursor: pointer;
            transition: background .25s ease, color .25s ease
        }

        .sound button:hover {
            background: #000;
            color: #fff
        }

        .viewport {
            min-height: calc(100vh - var(--header-h));
            display: grid;
            grid-template-rows: auto 1fr;
            padding-bottom: 0
        }

        .page {
            padding: 0 var(--side)
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            height: calc(100vh - var(--header-h));
            position: relative;

            /* í•œ ì¥ì§œë¦¬ ë°°ê²½ */
            background: url("img/book.svg") center/100% 100% no-repeat;
        }



        @media (max-width:1024px) {
            .grid-2 {
                grid-template-columns: 1fr
            }
        }

        /* íŒ¨ë„ ê³µí†µ */
        .panel {
            display: flex;
            flex-direction: column;
            width: 100%
        }

        .panel-header {
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px
        }

        .panel-title {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
            letter-spacing: .1px
        }

        .left,
        .right {
            display: flex
        }

        /* ì¢Œìš° íŒ¨ë„ ì—¬ë°±/ë†’ì´ ì •ë¦¬ */
        .left .panel,
        .right .panel {
            position: relative;
            height: calc(100% - 100px);
            margin: 50px;
            display: flex;
            flex-direction: column;

            /* ë°°ê²½ ì´ë¯¸ì§€ ê½‰ ì±„ìš°ê¸° (ì˜ë¦¼ ì—†ìŒ, ì™œê³¡ ê°€ëŠ¥) */
            background-size: 100% 100%;
            background-position: center;
            background-repeat: no-repeat;
        }

        /* LEFT â€” ì¹´ë“œ í”„ë¦¬ë·° ì˜ì—­ */
        .left .panel-body {
            overflow: hidden
        }

        /* ì¹´ë“œ+ì„¤ëª… ë¬¶ìŒì„ ì¤‘ì•™ ì •ë ¬ */
        .preview {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            flex-direction: column;
            align-items: center;
        }


        .card-set {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            /* ì¹´ë“œì™€ ì„¤ëª…ì„ í•¨ê»˜ ì¤‘ì•™ ì •ë ¬ */
            gap: 20px;
            /* ì¹´ë“œì™€ ì„¤ëª… ê°„ê²© */
        }

        .card {
            margin-top: 0%;
            /* ì›í•˜ëŠ” ë§Œí¼ ì¡°ì ˆ */
            width: min(340px, 90%);
            aspect-ratio: 2/3;
            border: var(--border-w) solid var(--line);
            padding: 16px 10px 83px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            overflow: hidden;
            border-radius: 0;
            position: relative;
            z-index: 2;
            /* ì„¤ëª…ë³´ë‹¤ ìœ„ì— ê³ ì • */
        }

        .card-art {
            border: var(--border-w) solid var(--line);
            position: relative;
            flex: 1 1 auto;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center
        }

        #flowerImg {
            display: none;
            max-width: 50vw;
            /* í™”ë©´ ì ˆë°˜ ì •ë„ í¬ê¸° */
            max-height: 70vh;
            /* ì„¸ë¡œ í¬ê²Œ */
            object-fit: contain;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        #flowerImg.big {
            display: block;
        }


        .overlay-prop {
            position: absolute;
            width: 34%;
            opacity: .95;
            pointer-events: none
        }

        .overlay-prop.prop-0 {
            left: 4%;
            bottom: 6%
        }

        .overlay-prop.prop-1 {
            right: 4%;
            top: 8%
        }

        .card-title {
            margin: 0;
            font-size: clamp(18px, 4.6vw, 26px);
            font-weight: 800;
            letter-spacing: .8px;
            font-family: ui-serif, "Times New Roman", Georgia, serif
        }

        .card-quote {
            width: 100%;
            min-height: 44px;
            padding: 10px 12px;
            text-align: center;
            color: #2a2a2a;
            font-size: 14px;
            font-style: italic;
            letter-spacing: .1px
        }

        .card-sub {
            color: #5a5a5a;
            font-size: clamp(12px, 2.6vw, 14px);
            letter-spacing: .2px
        }

        /* ì„¤ëª… ë°•ìŠ¤ëŠ” absolute ì œê±° â†’ ìì—°ìŠ¤ëŸ½ê²Œ ì¹´ë“œ ë°‘ì— ìœ„ì¹˜ */
        .desc-box {
            position: static;
            margin-top: 16px;
            /* ì¹´ë“œì™€ ê°„ê²© */
            width: min(440px, 92%);
            max-height: 120px;
            overflow: auto;
            padding: 12px 14px;
            background: rgba(255, 255, 255, .92);
            backdrop-filter: blur(4px);
            border-radius: 4px;
        }

        .desc-text {
            margin: 0;
            color: #333;
            line-height: 1.7;
            font-size: 14px;
            white-space: pre-line
        }

        /* RIGHT â€” ìŠ¤í… ë¬¶ìŒ ì¤‘ì•™ ì •ë ¬ */
        #stepsScroll {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: min(860px, 92%);
            max-height: calc(100% - 40px);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .step-block {
            width: 100%;
            padding: 16px;
            border-radius: 0;
            margin: 10px 0
        }

        .s1-title {
            font-size: 18px;
            font-weight: 500;
            letter-spacing: -.01em;
            margin: 6px 0 14px
        }

        .s1-row {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap
        }

        .s1-field {
            border: var(--border-w) solid var(--line);
            padding: 10px 12px;
            width: min(580px, 90vw)
        }

        .s1-field input {
            border: none;
            outline: none;
            width: 100%;
            font-size: 15px;
            background: transparent
        }

        .grid {
            display: grid;
            gap: 8px;
            grid-template-columns: repeat(4, minmax(0, 1fr))
        }

        @media (max-width:740px) {
            .grid {
                grid-template-columns: repeat(2, minmax(0, 1fr))
            }
        }

        .chip {
            border: var(--border-w) solid var(--line);
            padding: 10px 12px;
            border-radius: 0;
            cursor: pointer;
            text-align: center;
            transition: transform .12s, box-shadow .12s, background .12s, color .12s
        }

        .chip:hover {
            transform: translateY(-1px);
            box-shadow: 0 10px 24px rgba(0, 0, 0, .08)
        }

        .chip.active {
            background: #111;
            color: #fff;
            border-color: #111
        }

        button,
        .btn {
            border: var(--border-w) solid var(--line);
            border-radius: 0;
            padding: 10px 16px;
            font-weight: 400;
            cursor: pointer;
            transition: background .2s, color .2s, transform .1s
        }

        button:hover,
        .btn:hover {
            background: #000;
            color: #fff
        }

        button:active {
            transform: translateY(1px)
        }

        /* ì»¤ì„œ/ë°°ê²½ */
        .flower-cursor {
            position: fixed;
            left: 0;
            top: 0;
            z-index: 9999;
            pointer-events: none;
            user-select: none;
            width: 40px;
            height: 40px;
            display: grid;
            place-items: center;
            font-size: 24px;
            line-height: 1;
            transform: translate(-50%, -50%);
            filter: drop-shadow(0 2px 2px rgba(0, 0, 0, .12))
        }

        .flower-cursor::before {
            content: "";
            position: absolute;
            inset: 0;
            border: 2px solid #111;
            border-radius: 999px;
            box-sizing: border-box
        }

        .flower-cursor.active {
            font-size: 26px
        }

        .background-decor {
            position: fixed;
            inset: 0;
            overflow: hidden;
            z-index: -1
        }

        .butterfly {
            position: absolute;
            width: 80px;
            height: auto;
            animation: flutter 6s ease-in-out infinite;
            opacity: .85
        }

        @keyframes flutter {

            0%,
            100% {
                transform: translateY(0) rotate(0deg)
            }

            50% {
                transform: translateY(-20px) rotate(10deg)
            }
        }

        /* ì™¼ìª½ íŒ¨ë„ì„ ê·¸ë¦¬ë“œ ì¤‘ì•™ ì •ë ¬ ì»¨í…Œì´ë„ˆë¡œ */
        .left .panel-body {
            display: grid;
            place-items: center;
            height: 100%;
            padding: 0;
        }

        /* ì´ë¯¸ì§€: ì™¼ìª½ ê·¸ë¦¬ë“œ ì•ˆì—ì„œ 'ì‚´ì§ í¬ê²Œ' */
        #flowerImg {
            display: none;
            /* ì„ íƒ ì „ ìˆ¨ê¹€ */
            position: static;
            /* absolute ì œê±° */
            transform: none;

            max-width: clamp(360px, 46vw, 620px);
            max-height: clamp(320px, 60vh, 720px);
            width: auto;
            height: auto;
            object-fit: contain;
        }

        #flowerImg.big {
            display: block;
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header class="site">
        <div class="wrap">
            <div class="bar">
                <a class="brand" href="index.html" aria-label="MOODIARY Home">
                    <img src="img/sub-flower.svg" alt="MOODIARY ë¡œê³ "><span>MOODIARY</span>
                </a>
                <div></div>
                <nav class="main" aria-label="Main">
                    <a href="today-loding.html" class="active">Today</a>
                    <a href="diary-loding.html">Diary</a>
                    <a href="flower-loding.html">Flower</a>
                </nav>
                <div class="sound">
                    <button id="soundToggle" aria-pressed="false">ğŸ”Š Sound (On)</button>
                    <audio id="bgm" preload="auto" autoplay loop playsinline src="audio/temp.mp3"></audio>
                </div>
            </div>
        </div>
    </header>

    <div class="viewport">
        <main class="page">
            <div class="grid-2">
                <!-- LEFT -->
                <section class="left">
                    <div class="panel">
                        <!-- âœ… ë³µêµ¬ -->
                        <div class="panel-body">
                            <!-- ê°€ìš´ë° ì •ë ¬ ì»¨í…Œì´ë„ˆ -->
                            <img id="flowerImg" alt="">
                        </div>
                    </div>
                </section>

                <!-- RIGHT -->
                <section class="right">
                    <div class="panel">
                        <div class="progress-flowers" id="progressFlowers" aria-label="ì§„í–‰ ë‹¨ê³„">
                            <!-- (ì•„ì´ì½˜ë“¤ì€ í•„ìš” ì‹œ ì±„ì›Œ ì‚¬ìš©) -->
                        </div>
                        <div class="panel-body" id="stepsScroll">
                            <!-- STEP 1 -->
                            <section class="step-block" id="step-1">
                                <h2 class="s1-title">ì˜¤ëŠ˜ í•˜ë£¨, ì–´ë–¤ ê¸°ë¶„ì´ì—ˆë‚˜ìš”?</h2>
                                <div class="s1-row">
                                    <label class="s1-field"><input id="moodInput" type="text" maxlength="60"
                                            placeholder="ex) ì˜¤ëŠ˜ì€ ë§ˆìŒì´ ìš¸ì í•œ ê¸°ë¶„ì´ì•¼." autocomplete="off" /></label>
                                </div>
                            </section>
                            <!-- STEP 2 -->
                            <section class="step-block" id="step-2">
                                <h2 class="s1-title">ë¬¸ì¥ê³¼ ì–´ìš¸ë¦¬ëŠ” ê°ì • í‚¤ì›Œë“œë¥¼ ê³ ë¥´ì„¸ìš”.</h2>
                                <div class="grid" id="keywordGrid"></div>
                            </section>
                            <!-- STEP 3 -->
                            <section class="step-block" id="step-3">
                                <h2 class="s1-title">ê°ì •ì— ì–´ìš¸ë¦¬ëŠ” ë‚ ì”¨ë¥¼ 1ê°œ ê³¨ë¼ ê¾¸ë©°ì£¼ì„¸ìš”.</h2>
                                <div class="grid" id="propGrid"></div>
                            </section>
                            <!-- STEP 4 -->
                            <section class="step-block" id="step-4">
                                <div class="toolbar"
                                    style="display:flex;gap:10px;justify-content:flex-end;flex-wrap:wrap">
                                    <button id="goDiaryBtn" type="button">ë‹¤ì´ì–´ë¦¬ë¡œ ì´ë™ â†’</button>
                                    <button id="saveToday" class="primary" type="button">ì €ì¥í•˜ê³  ë‚ ì§œë¡œ ëŒì•„ê°€ê¸°</button>
                                </div>
                            </section>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <div class="background-decor" id="backgroundDecor"></div>

    <script>
        function stampCardTime(date) { const store = readTodayStore(); const prev = store[date] || { date }; prev.cardCreatedAt = Date.now(); store[date] = prev; writeTodayStore(store); }

        /* BGM */
        (function () {
            const audio = document.getElementById('bgm'), btn = document.getElementById('soundToggle');
            const STATE_KEY = 'moodiary_bgm_state', POS_KEY = 'moodiary_bgm_pos', VOL_KEY = 'moodiary_bgm_vol';
            function setBtn(on) { btn.textContent = on ? 'ğŸ”Š Sound (On)' : 'ğŸ”ˆ Sound (Off)'; btn.setAttribute('aria-pressed', on) }
            const fps = 60;
            function fadeTo(target = .35, ms = 800) {
                target = Math.max(0, Math.min(1, target));
                const step = (target - audio.volume) / (ms / (1000 / fps));
                const t = setInterval(() => {
                    audio.volume = Math.max(0, Math.min(1, audio.volume + step));
                    if ((step > 0 && audio.volume >= target) || (step < 0 && audio.volume <= target)) { clearInterval(t); localStorage.setItem(VOL_KEY, String(audio.volume)); }
                }, 1000 / fps);
            }
            async function tryPlay() {
                try { audio.muted = false; audio.volume = parseFloat(localStorage.getItem(VOL_KEY) || '0.30'); await audio.play(); setBtn(true); fadeTo(parseFloat(localStorage.getItem(VOL_KEY) || '0.35'), 700); }
                catch { setBtn(false); const unlock = async () => { try { await audio.play(); setBtn(true); fadeTo(parseFloat(localStorage.getItem(VOL_KEY) || '0.35'), 700); } catch { } finally { window.removeEventListener('pointerdown', unlock, { once: true }); } }; window.addEventListener('pointerdown', unlock, { once: true }); }
            }
            audio.addEventListener('loadedmetadata', () => {
                const pos = parseFloat(localStorage.getItem(POS_KEY) || '0');
                if (isFinite(pos) && pos > 0 && (!isFinite(audio.duration) || pos < audio.duration - 0.4)) { audio.currentTime = pos; }
            });
            const savePos = () => { if (isFinite(audio.currentTime)) localStorage.setItem(POS_KEY, String(audio.currentTime)); };
            setInterval(savePos, 1000); window.addEventListener('pagehide', savePos);
            btn.addEventListener('click', async () => { if (audio.paused) { localStorage.setItem(STATE_KEY, 'on'); await tryPlay(); } else { audio.pause(); setBtn(false); localStorage.setItem(STATE_KEY, 'off'); } });
            if ((localStorage.getItem(STATE_KEY) ?? 'on') === 'on') tryPlay(); else setBtn(false);
            document.addEventListener('visibilitychange', () => { if (!document.hidden && localStorage.getItem(STATE_KEY) === 'on' && audio.paused) tryPlay(); });
        })();

        /* ì²« ì§„ì… fresh */
        (function () {
            function z(n) { return String(n).padStart(2, '0') }
            function fmt(d) { return `${d.getFullYear()}-${z(d.getMonth() + 1)}-${z(d.getDate())}` }
            const u = new URL(location.href);
            if (!u.searchParams.has('fresh')) {
                if (!u.searchParams.get('date')) u.searchParams.set('date', fmt(new Date()));
                u.searchParams.set('fresh', '1'); return location.replace(u.toString());
            }
        })();

        /* ìš°ì¸¡ ìƒë‹¨ ì‹œê° í…ìŠ¤íŠ¸(ìš”ì†Œ ì—†ìœ¼ë©´ ìŠ¤í‚µ) */
        (function () {
            const el = document.getElementById('nowTime'); if (!el) return;
            function tick() { const now = new Date(); el.textContent = now.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' }); }
            tick(); setInterval(tick, 30 * 1000);
        })();
    </script>
    <script>
        // ... setFlowerImage(slug) í•¨ìˆ˜ ë°”ë¡œ ì•„ë˜ì— ì¶”ê°€í•˜ì„¸ìš”.
        function refreshPreview() {
            // ê°ì • í‚¤ì›Œë“œê°€ ì„ íƒë˜ë©´ ë‚´ê°€ ë§Œë“  flowers2 ì´ë¯¸ì§€ë¥¼ ì¤‘ì•™ í¬ê²Œ ë…¸ì¶œ
            if (state.keyword) {
                setFlowerImage(state.keyword.slug);
                flowerImg.classList.add('big');
                flowerImg.alt = state.keyword.flower || state.keyword.slug;
            } else {
                // ì„ íƒ í•´ì œ ì‹œ ìˆ¨ê¹€
                flowerImg.classList.remove('big');
                flowerImg.removeAttribute('src');
            }

            // ì§„í–‰ í‘œì‹œë§Œ ì—…ë°ì´íŠ¸(ì˜¤ë¥¸ìª½ ìŠ¤í… ê½ƒ ì•„ì´ì½˜ ë“±)
            updateProgressUI();
        }
    </script>

    <script>
        const KEYWORDS = [{ label: 'ê¸°ì¨', flower: 'ìˆ˜êµ­', slug: 'hydrangea' }, { label: 'ì„¤ë ˜', flower: 'ì•ˆê°œê½ƒ', slug: 'babybreath' }, { label: 'í‰ì˜¨', flower: 'ë¼ë²¤ë”', slug: 'lavender' }, { label: 'ìŠ¬í””', flower: 'í”„ë¦¬ì§€ì•„', slug: 'freesia' }, { label: 'ì™¸ë¡œì›€', flower: 'ë°ì´ì§€', slug: 'daisy' }, { label: 'í™”ë‚¨', flower: 'í° ë°±í•©', slug: 'white-lily' }, { label: 'ì§€ì¹¨', flower: 'ë¼ì¼ë½', slug: 'lilac' }, { label: 'ë¶ˆì•ˆ', flower: 'í° íŠ¤ë¦½', slug: 'white-tulip' }, { label: 'ê°ì‚¬', flower: 'í•´ë°”ë¼ê¸°', slug: 'sunflower' }, { label: 'í›„íšŒ', flower: 'ì‘ì•½', slug: 'peony' }, { label: 'ìƒì‹¤ê°', flower: 'ë¬¼ë§ì´ˆ', slug: 'forgetmenot' }, { label: 'í˜¼ë€', flower: 'ì—°ê½ƒ', slug: 'lotus' }];
        const EN_NAME = { 'hydrangea': 'HYDRANGEA', 'babybreath': "BABY'S BREATH", 'lavender': 'LAVENDER', 'freesia': 'FREESIA', 'daisy': 'DAISY', 'white-lily': 'WHITE LILY', 'lilac': 'LILAC', 'white-tulip': 'WHITE TULIP', 'sunflower': 'SUNFLOWER', 'peony': 'PEONY', 'forgetmenot': 'FORGET-ME-NOT', 'lotus': 'LOTUS' };
        const PROPS = [{ label: 'ë³„', slug: 'star', img: 'img/sp/star.svg' }, { label: 'ë°”ëŒ', slug: 'wind', img: 'img/sp/wind.svg' }, { label: 'ë‚˜ë¹„', slug: 'butterfly', img: 'img/sp/butterfly.svg' }, { label: 'ë¹„', slug: 'rain', img: 'img/sp/rain.svg' }, { label: 'êµ¬ë¦„', slug: 'cloud', img: 'img/sp/cloud.svg' }, { label: 'ìš¸íƒ€ë¦¬', slug: 'fence', img: 'img/sp/fence.svg' }, { label: 'ì”ë””', slug: 'grass', img: 'img/sp/grass.svg' }];

        const FLOWER_DESC = {
            'hydrangea': 'ì‘ì€ ê½ƒì†¡ì´ë“¤ì´ ëª¨ì—¬ ë‘¥ê¸€ê²Œ í”¼ëŠ” ìˆ˜êµ­ì€ â€˜ê°ì‚¬â€™ì™€ â€˜ì§„ì‹¬â€™ì„ ìƒì§•í•´ìš”. ê¸°ì¨ì´ ìŒ“ì—¬ ë” í° í–‰ë³µì´ ë˜ê³ , ì£¼ë³€ê³¼ ë‚˜ëˆ„ë©° ê¹Šì–´ì§€ëŠ” ê°ì •ì„ í‘œí˜„í•©ë‹ˆë‹¤.',
            'babybreath': 'ê°€ëŠ” ì¤„ê¸° ìœ„ì— ì´˜ì´˜íˆ í”¼ì–´ë‚œ ì•ˆê°œê½ƒì€ â€˜ìˆœìˆ˜í•œ ì‚¬ë‘â€™ê³¼ â€˜ë³€ì¹˜ ì•ŠëŠ” ë§ˆìŒâ€™ì„ ìƒì§•í•´ìš”. ì„¤ë ˜ì˜ ìˆœê°„ì´ ì”ì”í•œ ê¸°ëŒ€ê°ìœ¼ë¡œ ì´ì–´ì§€ë„ë¡ ë„ì™€ì¤ë‹ˆë‹¤.',
            'lavender': 'ë¼ë²¤ë”ëŠ” ì€ì€í•œ í–¥ê¸°ì™€ ë³´ëë¹›ìœ¼ë¡œ â€˜í‰ì˜¨â€™ê³¼ â€˜ì •ì„œì  ì•ˆì •â€™ì„ ì˜ë¯¸í•´ìš”. ë§ˆìŒì˜ ê¸´ì¥ì„ í’€ì–´ì£¼ê³  ì°¨ë¶„í•œ ìƒíƒœë¥¼ ìœ ì§€í•˜ê²Œ í•´ì¤ë‹ˆë‹¤.',
            'freesia': 'ë¶€ë“œëŸ½ê³  ë”°ëœ»í•œ ìƒ‰ê°ì˜ í”„ë¦¬ì§€ì•„ëŠ” â€˜ìœ„ë¡œâ€™ì™€ â€˜ìƒˆ ì¶œë°œâ€™ì„ ìƒì§•í•´ìš”. ìƒì‹¤ê°ê³¼ ìŠ¬í”” ì†ì—ì„œë„ ë‹¤ì‹œ ê±¸ì–´ ë‚˜ê°ˆ ìˆ˜ ìˆëŠ” í¬ë§ì„ ì „í•´ì¤ë‹ˆë‹¤.',
            'daisy': 'ë°ì´ì§€ëŠ” ë‹¨ìˆœí•˜ê³  ë°ì€ í˜•íƒœë¡œ â€˜ìˆœìˆ˜í•œ ìš°ì •â€™ê³¼ â€˜í¬ë§â€™ì„ ëœ»í•´ìš”. ì™¸ë¡œìš´ ë§ˆìŒì„ í¬ê·¼í•˜ê²Œ ê°ì‹¸ì£¼ë©°, ì‚¬ëŒê³¼ ë‹¤ì‹œ ì—°ê²°ë  ìˆ˜ ìˆëŠ” ê°€ëŠ¥ì„±ì„ ëŠë¼ê²Œ í•´ì¤ë‹ˆë‹¤.',
            'white-lily': 'í° ë°±í•©ì€ â€˜ìˆœìˆ˜í•¨â€™ê³¼ â€˜ì •í™”â€™ë¥¼ ìƒì§•í•´ìš”. ê²©í•´ì§„ ê°ì •ì„ ì¡°ìš©íˆ ê°€ë¼ì•‰íˆê³ , ë‚´ë©´ì˜ ê· í˜•ì„ ë˜ì°¾ì„ ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤ë‹ˆë‹¤.',
            'lilac': 'ë¼ì¼ë½ì€ â€˜íœ´ì‹â€™ê³¼ â€˜ì˜í˜¼ì˜ ì•ˆì •â€™ì„ ì˜ë¯¸í•˜ë©°, í–¥ê¸°ì™€ ìƒ‰ì´ ì§€ì¹œ ëª¸ê³¼ ë§ˆìŒì„ í¸ì•ˆí•˜ê²Œ ê°ì‹¸ì¤ë‹ˆë‹¤. íšŒë³µê³¼ ì‰¼ì„ ìƒì§•í•˜ëŠ” ê½ƒì´ì—ìš”.',
            'white-tulip': 'í•˜ì–€ íŠ¤ë¦½ì€ â€˜ìš©ê¸°â€™, â€˜ìƒˆë¡œìš´ ì‹œì‘â€™ì„ ìƒì§•í•´ìš”. ë¶ˆì•ˆí•œ ê°ì • ì†ì—ì„œë„ ë¶€ë“œëŸ½ê²Œ ìœ„ë¡œí•´ì£¼ë©°, ì•ìœ¼ë¡œ ë‚˜ì•„ê°ˆ ìˆ˜ ìˆëŠ” í˜ì„ ë¶ë‹ì•„ì¤ë‹ˆë‹¤.',
            'sunflower': 'íƒœì–‘ì„ í–¥í•´ í”¼ì–´ë‚˜ëŠ” í•´ë°”ë¼ê¸°ëŠ” â€˜ê¸ì •â€™, â€˜ì¡´ê²½â€™, â€˜ê°ì‚¬â€™ë¥¼ ì˜ë¯¸í•´ìš”. ë°ê³  í™œê¸°ì°¬ ê°ì •ì— ì—ë„ˆì§€ë¥¼ ë”í•˜ê³ , ê°ì‚¬í•œ ë§ˆìŒì„ ì „í•˜ëŠ” ë° ì í•©í•©ë‹ˆë‹¤.',
            'peony': 'í’ì„±í•˜ê³  í™”ë ¤í•œ ì‘ì•½ì€ â€˜í–‰ë³µí•œ ì‚¶â€™ê³¼ â€˜ê¹Šì€ ì• ì •â€™ì„ ìƒì§•í•´ìš”. ê³¼ê±°ì˜ í›„íšŒë¥¼ ë”°ëœ»í•˜ê²Œ ê°ì‹¸ë©°, ìŠ¤ìŠ¤ë¡œë¥¼ ë°›ì•„ë“¤ì´ê³  ì„±ì¥í•  ìˆ˜ ìˆëŠ” ìš©ê¸°ë¥¼ ì¤ë‹ˆë‹¤.',
            'forgetmenot': 'ì‘ê³  íŒŒë€ ë¬¼ë§ì´ˆëŠ” â€˜ì§„ì‹¤í•œ ì‚¬ë‘â€™ê³¼ â€˜ê¸°ì–µâ€™ì„ ëœ»í•´ìš”. ë– ë‚œ ê²ƒì— ëŒ€í•œ ì•„í””ì„ ì¸ì •í•˜ê³ , ì†Œì¤‘í•œ ê¸°ì–µìœ¼ë¡œ ê°„ì§í•  ìˆ˜ ìˆê²Œ ë„ì™€ì¤ë‹ˆë‹¤.',
            'lotus': 'ì§„í™ ì†ì—ì„œë„ ë§‘ê³  ê¹¨ë—í•˜ê²Œ í”¼ëŠ” ì—°ê½ƒì€ â€˜ì²­ì •â€™, â€˜ê·¹ë³µâ€™, â€˜ë‚´ë©´ì˜ í‰í™”â€™ë¥¼ ìƒì§•í•´ìš”. ë³µì¡í•˜ê³  í”ë“¤ë¦¬ëŠ” ë§ˆìŒì„ ì •ë¦¬í•˜ê³  ì¤‘ì‹¬ì„ ì¡ê²Œ í•´ì¤ë‹ˆë‹¤.'
        };

        // ì„ íƒí•œ ê°ì •ì˜ ì»¤ìŠ¤í…€ ì¹´ë“œ ì´ë¯¸ì§€ë¥¼ ì ìš© (ì—†ìœ¼ë©´ ê¸°ë³¸ í´ë”ë¡œ í´ë°±)
        function setFlowerImage(slug) {
            const custom = `img/flowers2/${slug}2.svg`;      // ë„¤ê°€ ë§Œë“  íŒŒì¼ ê·œì¹™
            const fallback = `img/flowers/${slug}.svg`;      // ê¸°ì¡´ ê¸°ë³¸ ì¹´ë“œ

            // ì—ëŸ¬ ë°œìƒ ì‹œ í•œ ë²ˆë§Œ í´ë°±
            flowerImg.onerror = null;
            flowerImg.src = custom;
            flowerImg.onerror = () => {
                flowerImg.onerror = null;
                flowerImg.src = fallback;
            };
        }

        const state = { mood: '', keyword: null, weather: null };
        const moodInput = document.getElementById('moodInput');
        const cardTitle = document.getElementById('cardTitle'), cardSub = document.getElementById('cardSub'), cardQuote = document.getElementById('cardQuote');
        const keywordGrid = document.getElementById('keywordGrid'), propGrid = document.getElementById('propGrid');
        const flowerImg = document.getElementById('flowerImg'), prop0 = document.getElementById('prop0'), prop1 = document.getElementById('prop1');
        const descBox = document.getElementById('flowerDescLeft'), descText = document.getElementById('flowerDescLeftText');

        function imgPath(type, slug) {
            if (type === 'weather') return `img/weather/${slug}.svg`;
            if (type === 'flower') return `img/flowers/${slug}.svg`;
            if (type === 'prop') { const p = PROPS.find(p => p.slug === slug); return p?.img || `img/props/${slug}.svg`; }
            return '';
        }
        function updateTexts() {
            if (state.keyword) {
                cardTitle.textContent = EN_NAME[state.keyword.slug] || state.keyword.slug.toUpperCase();
                cardSub.textContent = `${state.keyword.flower} Â· ${state.keyword.label}`;
            } else { cardTitle.textContent = ''; cardSub.textContent = ''; }
            cardQuote.textContent = state.mood || 'ì˜¤ëŠ˜ì˜ í•œ ì¤„ ê¸°ë¶„ì„ ì ì–´ì£¼ì„¸ìš”.';
        }
        function renderDescription() {
            const slug = state?.keyword?.slug;
            if (slug && FLOWER_DESC[slug]) { descText.textContent = FLOWER_DESC[slug]; descBox.hidden = false; }
            else { descBox.hidden = true; }
        }


        const WEATHERS = [{ label: 'í–‡ë¹›', slug: 'sun' }, { label: 'ë¹„', slug: 'rain' }, { label: 'ë²ˆê°œ', slug: 'lightning' }, { label: 'ëˆˆ', slug: 'snow' }];

        function renderKeywords() {
            keywordGrid.innerHTML = '';
            KEYWORDS.forEach(k => {
                const div = document.createElement('div'); div.className = 'chip'; div.textContent = k.label;
                div.addEventListener('click', () => {
                    if (state.keyword && state.keyword.slug === k.slug) { state.keyword = null;[...keywordGrid.children].forEach(el => el.classList.remove('active')); }
                    else { state.keyword = k;[...keywordGrid.children].forEach(el => el.classList.remove('active')); div.classList.add('active'); }
                    refreshPreview();
                });
                keywordGrid.appendChild(div);
            });
        }
        function renderWeather() {
            propGrid.innerHTML = '';
            WEATHERS.forEach(w => {
                const div = document.createElement('div'); div.className = 'chip'; div.textContent = w.label;
                if (state.weather && state.weather.slug === w.slug) div.classList.add('active');
                div.addEventListener('click', () => {
                    if (state.weather && state.weather.slug === w.slug) { state.weather = null;[...propGrid.children].forEach(el => el.classList.remove('active')); }
                    else { state.weather = w;[...propGrid.children].forEach(el => el.classList.remove('active')); div.classList.add('active'); }
                    refreshPreview(); updateProgressUI();
                });
                propGrid.appendChild(div);
            });
        }

        const flowers = [...document.getElementById('progressFlowers').querySelectorAll('.f')];
        function updateProgressUI() {
            const done1 = !!state.mood, done2 = !!state.keyword, done3 = !!state.weather, done4 = done1 && done2 && done3;
            flowers.forEach(el => el.classList.remove('todo', 'active', 'done'));
            if (flowers[0]) flowers[0].classList.add(done1 ? 'done' : 'active');
            if (flowers[1]) flowers[1].classList.add(done2 ? (done1 ? 'done' : 'todo') : (done1 ? 'active' : 'todo'));
            if (flowers[2]) flowers[2].classList.add(done3 ? (done1 && done2 ? 'done' : 'todo') : (done1 && done2 ? 'active' : 'todo'));
            if (flowers[3]) flowers[3].classList.add(done4 ? 'done' : 'todo');
        }
        moodInput.addEventListener('input', e => { state.mood = e.target.value.trim(); refreshPreview(); });

        function z(n) { return String(n).padStart(2, '0') }
        function fmt(d) { return [d.getFullYear(), z(d.getMonth() + 1), z(d.getDate())].join('-') }
        const url = new URL(location.href);
        const dateParam = url.searchParams.get('date') || fmt(new Date());
        const freshParam = url.searchParams.get('fresh') === '1';

        function readTodayStore() {
            try {
                const raw = localStorage.getItem('moodiary_today'); if (!raw) return {}; const v = JSON.parse(raw);
                if (Array.isArray(v)) { const o = {}; v.forEach(it => { if (it?.date) o[it.date] = it; }); return o; } return v && typeof v === 'object' ? v : {};
            } catch (e) { return {}; }
        }
        function writeTodayStore(obj) { localStorage.setItem('moodiary_today', JSON.stringify(obj)); }
        window.moodiaryGetToday = (d) => readTodayStore()[d] || null;

        document.getElementById('saveToday').addEventListener('click', () => {
            const store = JSON.parse(localStorage.getItem('moodiary_today') || '{}');
            const date = new URL(location.href).searchParams.get('date');

            store[date] = {
                date,
                oneLine: state.mood,
                feeling: state.keyword?.label,
                flowers: state.keyword
                    ? [{ slug: state.keyword.slug, name: state.keyword.flower, img: `img/flowers2/${state.keyword.slug}2.svg` }]
                    : [],
                weather: state.weather ? state.weather.slug : null,
                desc: state.keyword ? FLOWER_DESC[state.keyword.slug] : null
            };

            localStorage.setItem('moodiary_today', JSON.stringify(store));

            // âœ… day.htmlë¡œ ì´ë™í•˜ë©´ì„œ snap-day í•´ì‹œ ë¶™ì—¬ ì „ë‹¬
            location.href = `diary-loding.html?date=${encodeURIComponent(date)}#snap-day`;
        });


        document.getElementById('goDiaryBtn').addEventListener('click', () => {
            stampCardTime(dateParam);

            // 1ë‹¨ê³„: diary-loding.htmlë¡œ ì´ë™
            window.location.href = "diary-loding.html?next=day";
        });

        (function preloadIfExists() {
            if (freshParam) return;
            const saved = window.moodiaryGetToday(dateParam); if (!saved) return;
            state.mood = saved.feeling || ''; document.getElementById('moodInput').value = state.mood;
            if (saved.keywords && saved.keywords[0]) { const k = KEYWORDS.find(k => k.label === saved.keywords[0]); state.keyword = k || null; }
            if (saved.weather) { const w = WEATHERS.find(x => x.slug === saved.weather); state.weather = w || null; }
            refreshPreview();
        })();

        renderKeywords(); renderWeather(); refreshPreview(); updateProgressUI();

        /* âœ¿ custom cursor */
        (function () {
            const c = document.createElement('div'); c.className = 'flower-cursor'; c.textContent = 'âœ¿'; document.body.appendChild(c);
            let x = 0, y = 0, tx = 0, ty = 0;
            document.addEventListener('mousemove', e => { x = e.clientX; y = e.clientY; });
            document.addEventListener('mouseover', e => { if (e.target.closest('a,button')) c.classList.add('active'); else c.classList.remove('active'); });
            (function loop() { tx += (x - tx) * 0.25; ty += (y - ty) * 0.25; c.style.transform = `translate(${tx}px,${ty}px) translate(-50%,-50%)`; requestAnimationFrame(loop); })();
        })();

        // index.htmlì—ì„œ ì „ë‹¬ëœ text ê°’ì„ ì…ë ¥ì°½ì— ë°˜ì˜
        (function () {
            const u = new URL(location.href);
            const text = u.searchParams.get('text');
            if (text) { const moodInput = document.getElementById('moodInput'); if (moodInput) { moodInput.value = text; } }
        })();
    </script>

    <script>
        // (ì„ íƒ) ì˜¤ëŠ˜ ë‚ ì§œ í…ìŠ¤íŠ¸ â€” ìš”ì†Œ ì—†ìœ¼ë©´ ìŠ¤í‚µ
        (function () {
            const el = document.getElementById("todayDate"); if (!el) return;
            const now = new Date(); const z = n => String(n).padStart(2, '0'); const week = ["ì¼", "ì›”", "í™”", "ìˆ˜", "ëª©", "ê¸ˆ", "í† "];
            el.textContent = `ğŸ“… ${now.getFullYear()}-${z(now.getMonth() + 1)}-${z(now.getDate())} (${week[now.getDay()]})`;
        })();
    </script>
    <script>
        (function addButterflies() {
            const container = document.getElementById("backgroundDecor");
            const butterflyImgs = ["img/sp/butterfly1.svg", "img/sp/butterfly2.svg", "img/sp/butterfly3.svg", "img/sp/butterfly4.svg"];
            for (let i = 0; i < 6; i++) {
                const img = document.createElement("img");
                img.src = butterflyImgs[Math.floor(Math.random() * butterflyImgs.length)];
                img.className = "butterfly";
                img.style.top = Math.random() * 90 + "%";
                img.style.left = Math.random() * 90 + "%";
                img.style.width = (60 + Math.random() * 40) + "px";
                img.style.animationDuration = (5 + Math.random() * 4) + "s";
                container.appendChild(img);
            }
        })();
    </script>
</body>

</html>